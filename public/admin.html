<!DOCTYPE html>
<html>
<head>
	<title>Panel Admin</title>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
	<script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/14082/FileSaver.js" type="text/javascript"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" type="text/javascript"></script>

	
		<script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
		<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-auth.js"></script>
		<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-database.js"></script>
		<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-messaging.js"></script>

		
		<script>
		  // Initialize Firebase
		  var config = {
		    apiKey: "AIzaSyBM1wW2a1Ot1zsHkBSv7-dh2y20UZ_dFKI",
		    authDomain: "evaluacion-personal.firebaseapp.com",
		    databaseURL: "https://evaluacion-personal.firebaseio.com",
		    projectId: "evaluacion-personal",
		    storageBucket: "evaluacion-personal.appspot.com",
		    messagingSenderId: "67231726295"
		  };
		  firebase.initializeApp(config);
		  
	//   var database = firebase.database();
		</script>
	
	<script>
		firebase.auth().onAuthStateChanged(function(user) {
			 if (user) {
				//console.log(user);
				if (user.email !== "sderaadt@segurosorion.cl") {
					close();
				}
			  } 
			});
	</script>
	
	<script>
		function AddRow(evaluado, auto, total) {
			$('#evaluaciones').append('<tr><td>' + evaluado + '</td><td>' +  auto + '</td><td>' + total + '</td></tr>');
		}
		
		 // get all the json and iterate over it, calling AddRow
		var database = firebase.database();
		var evalsRef = database.ref().orderByKey();
		
		evalsRef.once('value', function(snapshot) {
		    snapshot.forEach(function(childSnapshot) {
				console.log(childSnapshot.key);
			    	childSnapshot.forEach(function(miniSnapshot) {
			    		  var childKey = miniSnapshot.key;
					  var childData = miniSnapshot.val();
						  var auto;
						  if (childKey.split('jefe').length > 1) {
						  	auto = false;
						  } else {
						  	auto = true;
						  }
						  var persona = childKey.split('_')[1];
						  AddRow(persona, auto, childData.total);
			    	});
		      
		    });
		});
		
	 </script>
	
	
</head>
<body>

<table id="evaluaciones">
<tr>
	<th>Evaluado</th> <th>¿Autoevaluación?</th><th>Total ponderado</th>
</tr>|
</table>

</body>
</html>
